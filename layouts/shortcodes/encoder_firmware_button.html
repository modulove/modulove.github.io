{{ if .Get "hex" }}
{{ if .Get "oledImage" }}
<div class="oled-preview-container">
  <img src="{{ .Get "oledImage" }}" alt="{{ .Get "buttonText" }} OLED preview" class="oled-preview-image">
</div>
{{ end }}

<div class="flash-firmware" data-hex-base="{{ .Get "hex" | safeURL }}" data-has-reversed="true">
  <!-- Step 1: Connect Device -->
  <div class="firmware-step">
    <div class="step-header">
      <span class="step-number">1</span>
      <span class="step-title">Connect Device</span>
    </div>
    <button class="flash-button connect-button" type="button">
      <span class="button-icon">üîå</span>
      Connect Arduino Nano
    </button>
    <div class="connection-status">
      <span class="status-indicator"></span>
      <span class="status-text">Not connected</span>
    </div>
  </div>

  <!-- Step 2: Upload Firmware -->
  <div class="firmware-step">
    <div class="step-header">
      <span class="step-number">2</span>
      <span class="step-title">Upload Firmware</span>
    </div>

    <!-- Normal encoder buttons -->
    <button
      class="flash-button upload-button flash-button-old-bootloader"
      arduino-uploader
      hex-href='/releases/{{ .Get "hex" | safeURL }}.nanoOldBootloader.hex'
      board="nanoOldBootloader"
    >
      <span class="button-icon">‚¨ÜÔ∏è</span>
      {{ with .Get "buttonText" }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }}
      <span class="upload-progress"></span>
    </button>

    <button
      class="flash-button upload-button flash-button-nano"
      style="display: none;"
      arduino-uploader
      hex-href='/releases/{{ .Get "hex" | safeURL }}.nano.hex'
      board="nano"
    >
      <span class="button-icon">‚¨ÜÔ∏è</span>
      {{ with .Get "buttonText" }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }}
      <span class="upload-progress"></span>
    </button>

    <!-- Reversed encoder buttons -->
    <div class="reversed-encoder-section" style="display: none;">
      <button
        class="flash-button upload-button flash-button-reversed-old"
        arduino-uploader
        hex-href='/releases/{{ .Get "hex" | safeURL }}.nanoOldBootloader.reversed.hex'
        board="nanoOldBootloader"
      >
        <span class="button-icon">‚¨ÜÔ∏è</span>
        {{ with .Get "buttonText" }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }} (Reversed Encoder)
        <span class="upload-progress"></span>
      </button>

      <button
        class="flash-button upload-button flash-button-reversed"
        style="display: none;"
        arduino-uploader
        hex-href='/releases/{{ .Get "hex" | safeURL }}.nano.reversed.hex'
        board="nano"
      >
        <span class="button-icon">‚¨ÜÔ∏è</span>
        {{ with .Get "buttonText" }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }} (Reversed Encoder)
        <span class="upload-progress"></span>
      </button>
    </div>

    <!-- Progress Bar -->
    <div class="upload-progress-container">
      <div class="progress-bar-track">
        <div class="progress-bar-fill"></div>
      </div>
      <div class="progress-stats">
        <span class="progress-percent">0%</span>
        <span class="progress-status">Waiting for upload...</span>
      </div>
    </div>
  </div>

  <div class="advanced-options">
    <label class="checkbox-label">
      <input type="checkbox" class="bootloader-toggle">
      <span>Use new bootloader (most Nanos after 2018)</span>
    </label>
    <label class="checkbox-label">
      <input type="checkbox" class="encoder-toggle">
      <span>Use reversed encoder direction</span>
    </label>
  </div>
</div>
{{ end }}
