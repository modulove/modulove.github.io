{{ $hex := .Get "hex" }}
{{ $buttonText := .Get "buttonText" }}
{{ $imageSlug := .Get "image" }}

{{ $imageMap := dict "3lfo" "3LFO" "adsr" "ADSR" "eg" "ENV" "euclid" "EUCLID" "lfo" "LFO" "random_cv_seq" "RND_SEQ" "sync_lfo" "SyncLFO" "clock" "CLOCK" "vco" "VCO" "burst" "BURST" }}
{{ $imageFile := index $imageMap $imageSlug }}

<div class="firmware-section mod1-firmware">
  <h2>{{ .Get "title" }}</h2>

  <div class="mod1-firmware-layout">
    {{ if $imageFile }}
    <div class="mod1-image-container">
      <a href="/images/mod1/MDL_HAGIWO-MOD1__{{ $imageFile }}.jpg"
         class="mod1-image-link"
         data-lightbox="mod1-{{ $imageSlug }}">
        <img
          src="/images/mod1/MDL_HAGIWO-MOD1__{{ $imageFile }}.jpg"
          alt="{{ .Get "title" }} module design"
          class="mod1-module-image"
          loading="lazy">
        <div class="image-overlay">
          <span>üîç Click to enlarge</span>
        </div>
      </a>
    </div>
    {{ end }}

    <div class="mod1-content">
      <div class="firmware-description">
        <h4>Features</h4>
        {{ .Inner }}
      </div>

      {{ if $hex }}
      <div class="flash-firmware">
        <button
          class="flash-button flash-button-old-bootloader"
          arduino-uploader
          hex-href='/releases/{{ $hex | safeURL }}.nanoOldBootloader.hex'
          board="nanoOldBootloader"
          [optional]verify
          [optional]port-filters='[{"usbProductId":46388,"usbVendorId":1241}]'
        >
          {{ with $buttonText }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }} to Arduino Nano (old bootloader)
          &nbsp;
          <span class="upload-progress"></span>
        </button>

        <div class="advanced-options">
          <label class="checkbox-label">
            <input type="checkbox" class="bootloader-toggle">
            <span>Show new bootloader option</span>
          </label>
        </div>

        <button
          class="flash-button flash-button-nano"
          style="display: none;"
          arduino-uploader
          hex-href='/releases/{{ $hex | safeURL }}.nano.hex'
          board="nano"
          [optional]verify
          [optional]port-filters='[{"usbProductId":46388,"usbVendorId":1241}]'
        >
          {{ with $buttonText }}{{ . | plainify }}{{ else -}} Upload Firmware {{ end }} to Arduino Nano
          &nbsp;
          <span class="upload-progress"></span>
        </button>
      </div>
      {{ end }}
    </div>
  </div>
</div>
